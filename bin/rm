#!/bin/bash
# Wrapper de seguridad para rm - VERSI√ìN COMPLETAMENTE SILENCIOSA

# Funci√≥n para detectar patrones peligrosos
is_dangerous() {
    local args="$*"
    local original_user="${SUDO_USER:-$USER}"
    local original_home="/home/$original_user"
    local root_home="/root"
    
    # 1. Cualquier rm recursivo sobre ra√≠z
    if [[ "$args" == "-r /" ]] || [[ "$args" == "-rf /" ]]; then
        return 0
    fi
    
    # 2. Cualquier rm recursivo sobre ~
    if [[ "$args" == "-r ~" ]] || [[ "$args" == "-rf ~" ]]; then
        return 0
    fi
    
    # 3. Cualquier rm recursivo sobre home del usuario original
    if [[ "$args" == "-r ${original_home}" ]] || [[ "$args" == "-rf ${original_home}" ]]; then
        return 0
    fi
    
    # 4. Cualquier rm recursivo sobre /root
    if [[ "$args" == "-r ${root_home}" ]] || [[ "$args" == "-rf ${root_home}" ]]; then
        return 0
    fi
    
    # 5. Detectar patrones con --no-preserve-root
    if [[ "$args" =~ --no-preserve-root ]]; then
        return 0
    fi
    
    # 6. Detectar cualquier rm recursivo sobre directorios /home/*
    if [[ "$args" =~ ^-r[f]?[[:space:]]+/home/ ]]; then
        return 0
    fi
    
    # 7. Verificaciones adicionales con patrones espec√≠ficos
    case "$args" in
        "-r /"|"-rf /")
            return 0
            ;;
        "-r ~"|"-rf ~")
            return 0
            ;;
        "-r /home/"*|"-rf /home/"*)
            return 0
            ;;
        "-r /root"|"-rf /root")
            return 0
            ;;
    esac
    
    return 1
}

# Verificar si el comando es peligroso (SIN LOGS)
if is_dangerous "$@"; then
    echo "üõë COMANDO BLOQUEADO POR SEGURIDAD DEL SISTEMA"
    echo "Comando: rm $*"
    if [[ -n "$SUDO_USER" ]]; then
        echo "Ejecutado por: $SUDO_USER (v√≠a sudo)"
    fi
    echo "Este comando ha sido identificado como potencialmente destructivo."
    echo "RAZ√ìN: Protecci√≥n contra eliminaci√≥n masiva de sistema o directorios home"
    exit 1
fi

# Ejecutar rm real si es seguro (COMPLETAMENTE SILENCIOSO)
exec /bin/rm "$@"
